!function(t){"use strict";function e(t,e){if("string"!=typeof t||"function"!=typeof e)throw new Error("First param should be a String, Second parameter should be a function")}function n(t){t=t||{},this._groups={},this._eventMap={},this._registredListenersCount=0,this._maxListeners=t.maxListeners||10,this._logger=t.logger||console.warn.bind(console),this._emit=t.async?this._emitAsync:this._emitSync,this._asyncQueue=t.async?[]:null}function i(t){this._emitSync.apply(this,t)}function r(t){t._asyncQueue.forEach(i,t),t._asyncQueue.length=0}function o(t,e){this.eventEmitter=t,this.group="."!==e.charAt(0)?"."+e:e}function s(){n.call(this),this._before=new n,this._after=new n}var u={each:function(t,e,n){var i,r;if("object"==typeof t||"string"==typeof t){var o=Object.keys(t);for(i=0,r=o.length;i<r;i++){var s=o[i];if(e.call(n,t[s],s,t)===!0)break}}},extend:function(t,e){this.each(e,function(e,n){t[n]=e})},inherits:function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t}}),t._super=e.prototype},indexOf:function(t,e){var n=-1;return this.each(t,function(t,i,r){if(e(t,i,r))return n=i,!0}),n},contains:function(t,e){return!!~t.indexOf(e)},arrayCopy:function(t){return Array.prototype.slice.call(t)},notGroup:function(t){return t.group!==this},notEvent:function(t){return t!==this}};u.extend(n.prototype,{_emitAsync:function(t){this._asyncQueue.length||setTimeout(r,0,this),this._asyncQueue.push(arguments)},_emitSync:function(t){if(this._eventMap[t]){var e=Array.prototype.slice.call(arguments,1),n=!1,i={event:t,group:null,stop:function(){n=!0}};u.each(this._eventMap[t],function(t){return i.group=t.group,t.handler.apply(i,e),n},this)}},_on:function(t,n){e(t,n);var i,r=this._eventMap;if(u.contains(t,".")){var o=t.split("."),s=this._groups;i=o[1],t=o[0],s[i]?s[i].push(t):s[i]=[t]}r[t]?r[t].push({group:i,handler:n}):r[t]=[{group:i,handler:n}],this._registredListenersCount++,this._registredListenersCount>this._maxListeners&&this._logger&&this._logger("Potentially memory leak was detected, max listeners count ["+this._maxListeners+"], registred ["+this._registredListenersCount+"]")},_off:function(t,e){var n;if(u.contains(t,".")){var i=t.split(".");t=i[0],n=i[1]}t&&n?this._offEventGroup(t,n):n?this._offGroup(n):this._offEvent(t,e)},_offEventGroup:function(t,e){if(this._groups[e]&&this._eventMap[t]){var n=this._eventMap[t].length;this._eventMap[t]=this._eventMap[t].filter(u.notGroup,e);var i=this._eventMap[t].length;this._groups[e]=this._groups[e].filter(u.notEvent,t),this._registredListenersCount-=n-i}},_offGroup:function(t){if(this._groups[t]){var e=u.arrayCopy(this._groups[t]);u.each(e,function(e){this._offEventGroup(e,t)},this),delete this._groups[t]}},_offEvent:function(t,e){if("function"==typeof e&&this._eventMap[t]){var n=u.indexOf(this._eventMap[t],function(t){return t.handler===e});~n&&this._eventMap[t].splice(n,1),this._registredListenersCount--}else if(this._eventMap[t]){var i=this._eventMap[t].length;u.each(this._eventMap[t],function(e){if(e.group){var n=this._groups[e.group],i=n.indexOf(t);n.splice(i,1)}},this),this._registredListenersCount-=i,delete this._eventMap[t]}}}),u.extend(n.prototype,{on:function(t,e){return Array.isArray(t)?u.each(t,function(t){this._on(t,e)},this):this._on(t,e),this},off:function(t,e){return Array.isArray(t)?u.each(t,function(t){this._off(t,e)},this):this._off(t,e),this},many:function(t,e,n){function i(){try{e.apply(this,arguments)}finally{o++,n<=o&&r.off(t,i)}}var r=this,o=0;return n=n<1||"number"!=typeof n?1:n,r.on(t,i),r},once:function(t,e){return this.many(t,e,1)},emit:function(){return this._emit.apply(this,arguments)},hasEvent:function(t){return this._eventMap.hasOwnProperty(t)},hasGroup:function(t){return this._groups.hasOwnProperty(t)},getMaxListeners:function(){return this._maxListeners},setMaxListeners:function(t){t>0&&(this._maxListeners=t)},toString:function(){return"[object EventEmitter]"}}),u.extend(n.prototype,{addEventListener:n.prototype.on,removeEventListener:n.prototype.off,trigger:n.prototype.emit}),u.extend(n,{isEventEmitter:function(t){return t instanceof n}}),u.extend(o.prototype,{on:function(t,e){var n;n=Array.isArray(t)?t.map(function(t){return t+this.group},this):t+this.group,this.eventEmitter.on(n,e)},emit:function(){this.eventEmitter.emit.apply(this.eventEmitter,arguments)},off:function(){this.eventEmitter.off(this.group)}}),u.extend(n.prototype,{group:function(t){return new o(this,t)}}),u.inherits(s,n),u.extend(s.prototype,{before:function(){this._before.on.apply(this._before,arguments)},after:function(){this._after.on.apply(this._after,arguments)},offBefore:function(){this._before.off.apply(this._before,arguments)},offAfter:function(){this._after.off.apply(this._after,arguments)},_emitSync:function(t){this.hasEvent(t)&&(this._before.emit(t),this.constructor._super._emitSync.apply(this,arguments),this._after.emit(t))}}),"undefined"!=typeof module?module.exports=s:"undefined"!=typeof exports?exports.EventEmitter=s:t.EventEmitter=s}(new Function("return this")());